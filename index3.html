<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
		<meta name="viewport" content="width=device-width,user-scalable=no"/>
		<title></title>
	</head>
	<body>

		<script type="text/javascript" src="pointjs_0.2.0.9.js"></script>

		<script type="text/javascript">

			var pjs = new PointJS(1100, 620, {backgroundColor: '#999999'})
			var game = pjs.game;
			var presets = pjs.presets;

			pjs.mouseControl.initControl();
			pjs.keyControl.initControl();

			var OOP = pjs.OOP;

			var player = game.newImageObject({
				file : "ball.png",
				x : 402,
				y : 20,
				w : 30,
				h : 30,
			})

			var fon = game.newImageObject({
				file : "1.png",
				x : 0,
				y : 0,
			});

			var map1 = {
				width : 40,
				height : 40,
				level : [
					'',
					'',
					'',
					'1                           1',
					'1                           1',
					'1                           1',
					'1                           1',
					'1                           1',
					'1          11               1',
					'1                           1',
					'1                           1',
					'1    11111111111111         1',
					'1                           1',
					'11111111111111111111111111111',
				]
			};

			var map = [];
			var eat = [];

			OOP.forArr(map1.level, function(string, y){
				OOP.forArr(string, function(el, x) {
					if (el == '1') {
						map.push(game.newImageObject({
							file : "block.jpg",
							x : x * map1.width,
							y : y * map1.height,
							w : 40,
							h : 40,
						})
					)}
					if (el == '2') {
						map.push(game.newImageObject({
							file : "coin.png",
							x : x * map1.width,
							y : y * map1.height,
							w : 40,
							h : 30,
						})
					)}
				})
			})

			var count = 0;

			var r = pjs.math.random;
			var WH = pjs.game.getWH();
			var W=WH.w;
			var H=WH.h;
			var wall = [];
			var DX = 0;
			var DY =0;

			var generate = function() {

				for (var i = 0; i<5; i++) {

					DX += r(300, 700);
					DY += r(-110, 110);

					wall.push(
						game.newImageObject({
							file : "3.png",
							x : DX + W,
							y : 340 - DY,
						}));

					wall.push(
						game.newImageObject({
							file : "3.png",
							x : DX + W,
							y : -720 - DY,
							angle: 180
						}));
				};
			};

			game.newLoop('myGame', function () {
				pjs.presets.bgCycle(fon, -2);
				generate();
				fon.draw();
				player.draw();
				OOP.drawArr(map);
				OOP.drawArr(eat);

				presets.physicsMoveInit(player, 3, 9.8, 0.02, 0, 0, 0.3, 3, 1, 0, ["D", "RIGHT"], ["A", "LEFT"], ["W"], ["LEFT"] );
				for (var i in map) {
					presets.physicsMoveCollision(map[i])
				}
				presets.physicsMove(); 


				for (var i in wall) {
					wall[i].x -=4;

					if (wall[i].x + wall[i].w < 0 && wall[i].y>0) {
						var G = r(-110, 110);
						count++;
					}

					if (wall[i].x + wall[i].w <0) {
						wall[i].x = 2400;

        				if (wall[i].y>0) {
        					wall[i].y = 340 - G;
        				}

						if (wall[i].y<0) {
							wall[i].y = -720 - G;
						}
					}

    				if (player.isStaticIntersect(wall[i].getStaticBox())) {
    					// game.setLoop('menu');
    				}
    				wall[i].draw();
    			}
			})

			game.setLoop('myGame');
			game.start();

		</script>

	</body>
</html>